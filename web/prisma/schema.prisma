generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model MarketOdds {
  id                 Int       @id @default(autoincrement())
  sport_type         String    @db.VarChar(20)
  team_name          String    @db.VarChar(100)
  web2_odds          Float?
  polymarket_price   Float?
  polymarket_url     String?
  kalshi_price       Float?
  kalshi_url         String?
  last_updated       DateTime? @default(now()) @db.Timestamp(6)
  source_bookmaker   String?   @db.VarChar(50)
  source_url         String?
  ai_analysis        String?
  analysis_timestamp DateTime? @db.Timestamp(6)
  aiPrediction       String?   @map("ai_prediction")
  aiProbability      Int?      @map("ai_probability")
  aiMarket           String?   @map("ai_market")
  aiRisk             String?   @db.VarChar(10) @map("ai_risk")
  aiGeneratedAt      DateTime? @map("ai_generated_at") @db.Timestamp(6)
  liquidity_usdc     Float?
  prop_type          String?   @default("championship") @db.VarChar(50)
  event_id           String?   @db.VarChar(50)

  @@index([sport_type, team_name], map: "idx_sport_team")
  @@index([sport_type], map: "idx_sport_type")
  @@index([team_name], map: "idx_team_name")
  @@index([prop_type], map: "idx_prop_type")
  @@map("market_odds")
}

model DailyMatch {
  id                 Int       @id @default(autoincrement())
  sport_type         String    @db.VarChar(20)
  match_id           String    @db.VarChar(100)
  home_team          String    @db.VarChar(100)
  away_team          String    @db.VarChar(100)
  commence_time      DateTime  @db.Timestamp(6)
  web2_home_odds     Float?
  web2_away_odds     Float?
  web2_draw_odds     Float?    // Soccer 3-way: Draw odds
  source_bookmaker   String?   @db.VarChar(50)
  source_url         String?
  poly_home_price    Float?
  poly_away_price    Float?
  poly_draw_price    Float?    // Soccer 3-way: Draw price
  polymarket_url     String?
  last_updated       DateTime? @default(now()) @db.Timestamp(6)
  ai_analysis        String?
  analysis_timestamp DateTime? @db.Timestamp(6)
  aiPrediction       String?   @map("ai_prediction")
  aiProbability      Int?      @map("ai_probability")
  aiMarket           String?   @map("ai_market")
  aiRisk             String?   @db.VarChar(10) @map("ai_risk")
  aiGeneratedAt      DateTime? @map("ai_generated_at") @db.Timestamp(6)
  liquidity_away     Float?
  liquidity_home     Float?
  liquidity_draw     Float?    // Soccer 3-way: Draw liquidity

  @@unique([sport_type, match_id])
  @@index([sport_type], map: "idx_daily_sport")
  @@index([commence_time], map: "idx_daily_time")
  @@map("daily_matches")
}

model OddsHistory {
  id               Int      @id @default(autoincrement())
  event_type       String   @db.VarChar(20)   // "championship" or "daily"
  event_id         String   @db.VarChar(100)  // team_name for championship, match_id for daily
  sport_type       String   @db.VarChar(20)

  // Championship 单一赔率 (向后兼容)
  web2_odds        Float?
  polymarket_price Float?

  // Daily Matches 主客场赔率
  web2_home_odds   Float?
  web2_away_odds   Float?
  web2_draw_odds   Float?   // Soccer 3-way: Draw odds
  poly_home_price  Float?
  poly_away_price  Float?
  poly_draw_price  Float?   // Soccer 3-way: Draw price

  // 流动性深度
  liquidity_usdc   Float?   // Championship 流动性
  liquidity_home   Float?   // Daily 主队流动性
  liquidity_away   Float?   // Daily 客队流动性
  liquidity_draw   Float?   // Daily 平局流动性 (Soccer)

  // 计算指标
  ev               Float?   // EV 差值

  recorded_at      DateTime @default(now()) @db.Timestamp(6)

  @@index([event_type, event_id], map: "idx_history_event")
  @@index([sport_type], map: "idx_history_sport")
  @@index([recorded_at], map: "idx_history_time")
  @@map("odds_history")
}
